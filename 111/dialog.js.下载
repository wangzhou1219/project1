!function($){"use strict";$.Zebra_Dialog=function(){var defaults={animation_speed_hide:250,animation_speed_show:0,auto_close:!1,buttons:!0,center_buttons:!0,custom_class:!1,keyboard:!0,max_height:0,message:"",modal:!0,overlay_close:!1,overlay_opacity:".5",position:"center",reposition_speed:500,show_close_button:!0,source:!1,title:"",type:"information",vcenter_short_message:!0,width:0,onClose:null},plugin=this,options={},timeout;plugin.settings={},"string"==typeof arguments[0]&&(options.message=arguments[0]),("object"==typeof arguments[0]||"object"==typeof arguments[1])&&(options=$.extend(options,"object"==typeof arguments[0]?arguments[0]:arguments[1])),plugin.init=function(){var a;plugin.settings=$.extend({},defaults,options),plugin.isIE6="explorer"==browser.name&&6==browser.version||!1,plugin.settings.modal&&(plugin.overlay=$("<div>",{"class":"ZebraDialogOverlay"}).css({position:plugin.isIE6?"absolute":"fixed",left:0,top:0,opacity:plugin.settings.overlay_opacity}),plugin.settings.overlay_close&&plugin.overlay.bind("click",function(){plugin.close()}),plugin.overlay.appendTo("body")),plugin.dialog=$("<div>",{"class":"ZebraDialog"+(plugin.settings.custom_class?" "+plugin.settings.custom_class:"")}).css({position:plugin.isIE6?"absolute":"fixed",left:0,top:0,visibility:"hidden"}),!plugin.settings.buttons&&plugin.settings.auto_close&&plugin.dialog.attr("id","ZebraDialog_"+Math.floor(9999999*Math.random()));var b=parseInt(plugin.settings.width,10);!isNaN(b)&&b==plugin.settings.width&&b.toString()==plugin.settings.width.toString()&&b>0&&plugin.dialog.css({width:plugin.settings.width}),plugin.settings.title&&(a=$("<h3>",{"class":"ZebraDialog_Title"}).html(plugin.settings.title).appendTo(plugin.dialog));var c=get_buttons(),d=$("<div>",{"class":"ZebraDialog_BodyOuter"+(plugin.settings.title?"":" ZebraDialog_NoTitle")+(c?"":" ZebraDialog_NoButtons")}).appendTo(plugin.dialog);if(plugin.message=$("<div>",{"class":"ZebraDialog_Body"+(get_type()!==!1?" ZebraDialog_Icon ZebraDialog_"+get_type():"")}),plugin.settings.max_height>0&&(plugin.message.css("max-height",plugin.settings.max_height),plugin.isIE6&&plugin.message.attr("style","height: expression(this.scrollHeight > "+plugin.settings.max_height+' ? "'+plugin.settings.max_height+'px" : "85px")')),plugin.settings.vcenter_short_message?$("<div>").html(plugin.settings.message).appendTo(plugin.message):plugin.message.html(plugin.settings.message),plugin.settings.source&&"object"==typeof plugin.settings.source){var e=plugin.settings.vcenter_short_message?$("div:first",plugin.message):plugin.message;for(var f in plugin.settings.source)switch(f){case"ajax":var g="string"==typeof plugin.settings.source[f]?{url:plugin.settings.source[f]}:plugin.settings.source[f],h=$("<div>").attr("class","ZebraDialog_Preloader").appendTo(e);g.success=function(a){h.remove(),e.append(a),draw(!1)},$.ajax(g);break;case"iframe":var i={width:"100%",height:"100%",marginheight:"0",marginwidth:"0",frameborder:"0"},j=$.extend(i,"string"==typeof plugin.settings.source[f]?{src:plugin.settings.source[f]}:plugin.settings.source[f]);e.append($("<iframe>").attr(j));break;case"inline":e.append(plugin.settings.source[f])}}if(plugin.message.appendTo(d),c){c.reverse();var k=$("<div>",{"class":"ZebraDialog_Buttons"}).appendTo(plugin.dialog);$.each(c,function(a,b){var c=$("<a>",{href:"javascript:void(0)","class":"ZebraDialog_Button_"+a});$.isPlainObject(b)?c.html(b.caption):c.html(b),c.bind("click",function(){var a=!0;void 0!==b.callback&&(a=b.callback(plugin.dialog)),a!==!1&&plugin.close(void 0!==b.caption?b.caption:b)}),c.appendTo(k)}),k.wrap($("<div>").addClass("ZebraDialog_ButtonsOuter"+(plugin.settings.center_buttons?" ZebraDialog_Buttons_Centered":"")))}if(plugin.dialog.appendTo("body"),plugin.settings.show_close_button){var l=$('<a href="javascript:void(0)" class="ZebraDialog_Close">&times;</a>').bind("click",function(a){a.preventDefault(),plugin.close()}).appendTo(a?a:plugin.message);a&&l.css({right:parseInt(a.css("paddingRight"),10),top:(parseInt(a.css("height"),10)+parseInt(a.css("paddingTop"),10)+parseInt(a.css("paddingBottom"),10)-l.height())/2})}return $(window).bind("resize.Zebra_Dialog",function(){clearTimeout(timeout),timeout=setTimeout(function(){draw()},100)}),plugin.settings.keyboard&&$(document).bind("keyup.Zebra_Dialog",function(a){return 27==a.which&&plugin.close(),!0}),plugin.isIE6&&$(window).bind("scroll.Zebra_Dialog",function(){emulate_fixed_position()}),plugin.settings.auto_close!==!1&&(plugin.dialog.bind("click",function(){clearTimeout(plugin.timeout),plugin.close()}),plugin.timeout=setTimeout(plugin.close,plugin.settings.auto_close)),draw(!1),plugin},plugin.close=function(a){$(document).unbind(".Zebra_Dialog"),$(window).unbind(".Zebra_Dialog"),plugin.overlay&&plugin.overlay.animate({opacity:0},plugin.settings.animation_speed_hide,function(){plugin.overlay.remove()}),plugin.dialog.animate({top:0,opacity:0},plugin.settings.animation_speed_hide,function(){plugin.dialog.remove(),plugin.settings.onClose&&"function"==typeof plugin.settings.onClose&&plugin.settings.onClose(void 0!==a?a:"")})};var draw=function(){var viewport_width=$(window).width(),viewport_height=$(window).height(),dialog_width=plugin.dialog.width(),dialog_height=plugin.dialog.height(),values={left:0,top:0,right:viewport_width-dialog_width,bottom:viewport_height-dialog_height,center:(viewport_width-dialog_width)/2,middle:(viewport_height-dialog_height)/2};if(plugin.dialog_left=void 0,plugin.dialog_top=void 0,$.isArray(plugin.settings.position)&&2==plugin.settings.position.length&&"string"==typeof plugin.settings.position[0]&&plugin.settings.position[0].match(/^(left|right|center)[\s0-9\+\-]*$/)&&"string"==typeof plugin.settings.position[1]&&plugin.settings.position[1].match(/^(top|bottom|middle)[\s0-9\+\-]*$/)&&(plugin.settings.position[0]=plugin.settings.position[0].toLowerCase(),plugin.settings.position[1]=plugin.settings.position[1].toLowerCase(),$.each(values,function(index,value){for(var i=0;2>i;i++){var tmp=plugin.settings.position[i].replace(index,value);tmp!=plugin.settings.position[i]&&(0===i?plugin.dialog_left=eval(tmp):plugin.dialog_top=eval(tmp))}})),(void 0===plugin.dialog_left||void 0===plugin.dialog_top)&&(plugin.dialog_left=values.center,plugin.dialog_top=values.middle),plugin.settings.vcenter_short_message){var message=plugin.message.find("div:first"),message_height=message.height(),container_height=plugin.message.height();container_height>message_height&&message.css({"padding-top":(container_height-message_height)/2})}"boolean"==typeof arguments[0]&&arguments[0]===!1||0===plugin.settings.reposition_speed?plugin.dialog.css({left:plugin.dialog_left,top:plugin.dialog_top,visibility:"visible",opacity:0}).animate({opacity:1},plugin.settings.animation_speed_show):(plugin.dialog.stop(!0),plugin.dialog.css("visibility","visible").animate({left:plugin.dialog_left,top:plugin.dialog_top},plugin.settings.reposition_speed)),plugin.dialog.find("a[class^=ZebraDialog_Button]:first").focus(),plugin.isIE6&&setTimeout(emulate_fixed_position,500)},emulate_fixed_position=function(){var a=$(window).scrollTop(),b=$(window).scrollLeft();plugin.settings.modal&&plugin.overlay.css({top:a,left:b}),plugin.dialog.css({left:plugin.dialog_left+b,top:plugin.dialog_top+a})},get_buttons=function(){if(plugin.settings.buttons!==!0&&!$.isArray(plugin.settings.buttons))return!1;if(plugin.settings.buttons===!0)switch(plugin.settings.type){case"question":plugin.settings.buttons=["确定","取消"];break;default:plugin.settings.buttons=["确定"]}return plugin.settings.buttons},get_type=function(){switch(plugin.settings.type){case"confirmation":case"error":case"information":case"question":case"warning":return plugin.settings.type.charAt(0).toUpperCase()+plugin.settings.type.slice(1).toLowerCase();default:return!1}},browser={init:function(){this.name=this.searchString(this.dataBrowser)||"",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||""},searchString:function(a){for(var b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;if(this.versionSearchString=a[b].versionSearch||a[b].identity,c){if(-1!=c.indexOf(a[b].subString))return a[b].identity}else if(d)return a[b].identity}},searchVersion:function(a){var b=a.indexOf(this.versionSearchString);if(-1!=b)return parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"MSIE",identity:"explorer",versionSearch:"MSIE"}]};return browser.init(),plugin.init()}}(jQuery);

jQuery.fn.boxy=function(options){options=options||{};return this.each(function(){var node=this.nodeName.toLowerCase(),self=this;if(node=="a"){jQuery(this).click(function(){var active=Boxy.linkedTo(this),href=this.getAttribute("href"),localOptions=jQuery.extend({actuator:this,title:this.title},options);if(active){active.show()}else{if(href.indexOf("#")>=0){var content=jQuery(href.substr(href.indexOf("#"))),newContent=content.clone(true);content.remove();localOptions.unloadOnHide=false;new Boxy(newContent,localOptions)}else{if(!localOptions.cache){localOptions.unloadOnHide=true}Boxy.load(this.href,localOptions)}}return false})}else{if(node=="form"){jQuery(this).bind("submit.boxy",function(){Boxy.confirm(options.message||"Please confirm:",function(){jQuery(self).unbind("submit.boxy").submit()});return false})}}})};function Boxy(element,options){this.boxy=jQuery(Boxy.WRAPPER);jQuery.data(this.boxy[0],"boxy",this);this.visible=false;this.options=jQuery.extend({},Boxy.DEFAULTS,options||{});this.options.useIframe=(this.options.useIframe&&jQuery.browser.msie&&jQuery.browser.version<7);if(this.options.useIframe){this.options=jQuery.extend(this.options,{modal:true})}if(this.options.modal){this.options=jQuery.extend(this.options,{center:true,draggable:false})}if(this.options.actuator){jQuery.data(this.options.actuator,"active.boxy",this)}this.setContent(element||"<div></div>");this._setupTitleBar();this.boxy.css("display","none").appendTo(document.body);this.toTop();if(this.options.fixed){if(jQuery.browser.msie&&jQuery.browser.version<7){this.options.fixed=false}else{this.boxy.addClass("fixed")}}if(this.options.center&&Boxy._u(this.options.x,this.options.y)){this.center()}else{this.moveTo(Boxy._u(this.options.x)?this.options.x:Boxy.DEFAULT_X,Boxy._u(this.options.y)?this.options.y:Boxy.DEFAULT_Y)}if(this.options.show){this.show()}}Boxy.EF=function(){};jQuery.extend(Boxy,{WRAPPER:"<div class='boxy-wrapper'><div class='boxy-inner'></div></div>",DEFAULTS:{title:null,closeable:true,draggable:true,clone:false,actuator:null,center:true,show:true,modal:false,fixed:true,closeText:"×",unloadOnHide:false,clickToFront:false,behaviours:Boxy.EF,afterDrop:Boxy.EF,afterShow:Boxy.EF,afterHide:Boxy.EF,beforeUnload:Boxy.EF,useIframe:false},DEFAULT_X:50,DEFAULT_Y:50,zIndex:1337,dragConfigured:false,resizeConfigured:false,dragging:null,load:function(url,options){options=options||{};var ajax={url:url,type:"GET",dataType:"html",cache:false,success:function(html){html=jQuery(html);if(options.filter){html=jQuery(options.filter,html)}new Boxy(html,options)}};jQuery.each(["type","cache"],function(){if(this in options){ajax[this]=options[this];delete options[this]}});jQuery.ajax(ajax)},get:function(ele){var p=jQuery(ele).parents(".boxy-wrapper");return p.length?jQuery.data(p[0],"boxy"):null},linkedTo:function(ele){return jQuery.data(ele,"active.boxy")},alert:function(message,callback,options){return Boxy.ask(message,["确定"],callback,options)},confirm:function(message,after,options){return Boxy.ask(message,["确定","取消"],function(response){if(response=="确定"){after()}},options)},ask:function(question,answers,callback,options){options=jQuery.extend({modal:true,closeable:false},options||{},{show:true,unloadOnHide:true});var body=jQuery("<div></div>").append(jQuery('<div class="question"></div>').html(question));var map={},answerStrings=[];if(answers instanceof Array){for(var i=0;i<answers.length;i++){map[answers[i]]=answers[i];answerStrings.push(answers[i])}}else{for(var k in answers){map[answers[k]]=k;answerStrings.push(answers[k])}}var buttons=jQuery('<form class="answers"></form>');buttons.html(jQuery.map(answerStrings,function(v){return"<input type='button' value='"+v+"' />"}).join(" "));jQuery("input[type=button]",buttons).click(function(){var clicked=this;Boxy.get(this).hide(function(){if(callback){callback(map[clicked.value])}})});body.append(buttons);new Boxy(body,options)},isModalVisible:function(){return jQuery(".boxy-modal-blackout").length>0},_u:function(){for(var i=0;i<arguments.length;i++){if(typeof arguments[i]!="undefined"){return false}}return true},_handleResize:function(evt){var d=jQuery(document);jQuery(".boxy-modal-blackout").css("display","none").css({width:d.width(),height:d.height()}).css("display","block")},_handleDrag:function(evt){var d;if(d=Boxy.dragging){d[0].boxy.css({left:evt.pageX-d[1],top:evt.pageY-d[2]})}},_nextZ:function(){return Boxy.zIndex++},_viewport:function(){var d=document.documentElement,b=document.body,w=window;return jQuery.extend(jQuery.browser.msie?{left:b.scrollLeft||d.scrollLeft,top:b.scrollTop||d.scrollTop}:{left:w.pageXOffset,top:w.pageYOffset},!Boxy._u(w.innerWidth)?{width:w.innerWidth,height:w.innerHeight}:(!Boxy._u(d)&&!Boxy._u(d.clientWidth)&&d.clientWidth!=0?{width:d.clientWidth,height:d.clientHeight}:{width:b.clientWidth,height:b.clientHeight}))}});Boxy.prototype={estimateSize:function(){this.boxy.css({visibility:"hidden",display:"block"});var dims=this.getSize();this.boxy.css("display","none").css("visibility","visible");return dims},getSize:function(){return[this.boxy.width(),this.boxy.height()]},getContentSize:function(){var c=this.getContent();return[c.width(),c.height()]},getPosition:function(){var b=this.boxy[0];return[b.offsetLeft,b.offsetTop]},getCenter:function(){var p=this.getPosition();var s=this.getSize();return[Math.floor(p[0]+s[0]/2),Math.floor(p[1]+s[1]/2)]},getInner:function(){return jQuery(".boxy-inner",this.boxy)},getContent:function(){return jQuery(".boxy-content",this.boxy)},setContent:function(newContent){newContent=jQuery(newContent).css({display:"block"}).addClass("boxy-content");if(this.options.clone){newContent=newContent.clone(true)}this.getContent().remove();this.getInner().append(newContent);this._setupDefaultBehaviours(newContent);this.options.behaviours.call(this,newContent);return this},moveTo:function(x,y){this.moveToX(x).moveToY(y);return this},moveToX:function(x){if(typeof x=="number"){this.boxy.css({left:x})}else{this.centerX()}return this},moveToY:function(y){if(typeof y=="number"){this.boxy.css({top:y})}else{this.centerY()}return this},centerAt:function(x,y){var s=this[this.visible?"getSize":"estimateSize"]();if(typeof x=="number"){this.moveToX(x-s[0]/2)}if(typeof y=="number"){this.moveToY(y-s[1]/2)}return this},centerAtX:function(x){return this.centerAt(x,null)},centerAtY:function(y){return this.centerAt(null,y)},center:function(axis){var v=Boxy._viewport();var o=this.options.fixed?[0,0]:[v.left,v.top];if(!axis||axis=="x"){this.centerAt(o[0]+v.width/2,null)}if(!axis||axis=="y"){this.centerAt(null,o[1]+v.height/2)}return this},centerX:function(){return this.center("x")},centerY:function(){return this.center("y")},resize:function(width,height,after){if(!this.visible){return}var bounds=this._getBoundsForResize(width,height);this.boxy.css({left:bounds[0],top:bounds[1]});this.getContent().css({width:bounds[2],height:bounds[3]});if(after){after(this)}return this},tween:function(width,height,after){if(!this.visible){return}var bounds=this._getBoundsForResize(width,height);var self=this;this.boxy.stop().animate({left:bounds[0],top:bounds[1]});this.getContent().stop().animate({width:bounds[2],height:bounds[3]},function(){if(after){after(self)}});return this},isVisible:function(){return this.visible},show:function(){if(this.visible){return}if(this.options.modal){var self=this;if(!Boxy.resizeConfigured){Boxy.resizeConfigured=true;jQuery(window).resize(function(){Boxy._handleResize()})}this.modalBlackout=jQuery('<div class="boxy-modal-blackout"></div>').css({zIndex:Boxy._nextZ(),opacity:0,width:jQuery(document).width(),height:jQuery(document).height()}).appendTo(document.body);this.toTop();if(this.options.closeable){jQuery(document.body).bind("keypress.boxy",function(evt){var key=evt.which||evt.keyCode;if(key==27){self.hide();jQuery(document.body).unbind("keypress.boxy")}})}}this.boxy.stop().css({opacity:1}).show();this.visible=true;this._fire("afterShow");this.center();if(this.options.useIframe==true){this.temp_iframe=jQuery("<iframe class='bg_iframe' src='javascript:void(0);' scrolling='no' frameborder='0' style='position: absolute;'></iframe>");this.temp_iframe.width(this.getSize()[0]);this.temp_iframe.height(this.getSize()[1]);this.temp_iframe[0].zIndex=-1;var v=Boxy._viewport();this.temp_iframe.css("top",this.getPosition()[1]);this.temp_iframe.css("left",this.getPosition()[0]);jQuery(document.body).append(this.temp_iframe);this.toTop()}return this},auto_resize:function(){if(this.options.useIframe==true){this.temp_iframe.width(this.getSize()[0]);this.temp_iframe.height(this.getSize()[1])}},hide:function(after){if(!this.visible){return}var self=this;if(this.options.modal){jQuery(document.body).unbind("keypress.boxy");this.modalBlackout.animate({opacity:0},function(){jQuery(this).remove()})}this.boxy.stop().animate({opacity:0},300,function(){self.boxy.css({display:"none"});self.visible=false;self._fire("afterHide");if(after){after(self)}if(self.options.unloadOnHide){self.unload()}});if(this.options.useIframe==true){jQuery("iframe").remove(".bg_iframe")}return this},toggle:function(){this[this.visible?"hide":"show"]();return this},hideAndUnload:function(after){this.options.unloadOnHide=true;this.hide(after);return this},unload:function(){this._fire("beforeUnload");this.boxy.remove();if(this.options.actuator){jQuery.data(this.options.actuator,"active.boxy",false)}},toTop:function(){this.boxy.css({zIndex:Boxy._nextZ()});return this},getTitle:function(){return jQuery("> .title-bar h2",this.getInner()).html()},setTitle:function(t){jQuery("> .title-bar h2",this.getInner()).html(t);return this},_getBoundsForResize:function(width,height){var csize=this.getContentSize();var delta=[width-csize[0],height-csize[1]];var p=this.getPosition();return[Math.max(p[0]-delta[0]/2,0),Math.max(p[1]-delta[1]/2,0),width,height]},_setupTitleBar:function(){if(this.options.title){var self=this;var tb=jQuery("<div class='title-bar'></div>").html("<h2>"+this.options.title+"</h2>");if(this.options.closeable){tb.append(jQuery("<a href='#' class='close'></a>").html(this.options.closeText))}if(this.options.draggable){tb[0].onselectstart=function(){return false};tb[0].unselectable="on";tb[0].style.MozUserSelect="none";if(!Boxy.dragConfigured){jQuery(document).mousemove(Boxy._handleDrag);Boxy.dragConfigured=true}tb.mousedown(function(evt){self.toTop();Boxy.dragging=[self,evt.pageX-self.boxy[0].offsetLeft,evt.pageY-self.boxy[0].offsetTop];jQuery(this).addClass("dragging")}).mouseup(function(){jQuery(this).removeClass("dragging");Boxy.dragging=null;self._fire("afterDrop")})}this.getInner().prepend(tb);this._setupDefaultBehaviours(tb)}},_setupDefaultBehaviours:function(root){var self=this;if(this.options.clickToFront){root.click(function(){self.toTop()})}jQuery(".close",root).click(function(){self.hide();return false}).mousedown(function(evt){evt.stopPropagation()})},_fire:function(event){this.options[event].call(this)}};